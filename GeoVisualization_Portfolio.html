<!DOCTYPE html>
<html lang='en'><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoVisualization Portfolio</title>

    <meta name="portfolio-id" content="fe4c7ae6-2bc3-461d-92f3-b8c545c4aaa9">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <style>
        :root {
            --sidebar-width: 280px;
            --primary: #2c3e50;
            --accent: #27ae60;
            --danger: #e74c3c;
            --bg-color: #f8f9fa;
            --text-light: #ecf0f1;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: var(--bg-color);
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #555;
            margin: 0 auto 10px;
            border: 3px solid var(--accent);
            overflow: hidden;
            position: relative;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: #bdc3c7;
            text-align: left;
            padding: 15px;
            cursor: pointer;
            font-size: 1rem;
            transition: 0.3s;
            border-radius: 8px;
            width: 100%;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid var(--accent);
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            overflow-y: auto;
            position: relative;
            scroll-behavior: smooth;
            padding-bottom: 100px;
        }

        .page-section {
            display: none;
            padding: 40px;
        }

        .page-section.active {
            display: block;
            animation: fadeUp 0.5s ease;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- WEEK BLOCKS --- */
        .week-block {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            border-left: 6px solid var(--accent);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .category-section {
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 1.1rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
            margin-bottom: 15px;
            display: inline-block;
        }

        /* --- GALLERY GRID --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: scale(1.02);
            z-index: 2;
        }

        .gallery-item:hover .img-container {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .img-container {
            height: 200px;
            width: 100%;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: #eee;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: 0.5s;
        }

        .item-data {
            display: none;
        }

        body.editing .item-data {
            display: flex;
            flex-direction: column;
            background: #fafafa;
            border: 1px dashed #ccc;
            padding: 10px;
            margin-top: 5px;
        }

        body.editing .gallery-item {
            cursor: default;
            transform: none;
        }

        .gallery-item[data-type="text"] {
            background: white;
            border: 1px solid #eee;
            height: 200px;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .gallery-item[data-type="text"] .item-data {
            display: block;
            height: 100%;
            overflow: hidden;
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        .gallery-item[data-type="text"] .img-container {
            display: none;
        }

        /* --- EDITING UI --- */
        .delete-btn {
            display: none;
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.8rem;
            position: absolute;
            top: 5px;
            right: 5px;
            z-index: 20;
        }

        .editing .delete-btn {
            display: block;
        }

        .add-area-small {
            display: none;
            text-align: center;
            border: 2px dashed #ddd;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            color: #aaa;
            margin-top: 10px;
        }

        .add-area-small:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .add-area-big {
            display: none;
            margin: 40px 0;
            border: 3px dashed #ccc;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            color: #777;
            border-radius: 15px;
            font-size: 1.5rem;
        }

        .add-area-big:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .editing .add-area-small,
        .editing .add-area-big {
            display: block;
        }

        .file-upload-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        .editing .file-upload-overlay {
            display: flex;
        }

        .editable-field {
            border: 1px dashed transparent;
            cursor: default;
        }

        .editing .editable-field {
            border: 1px dashed #f39c12;
            background: rgba(255, 255, 100, 0.1);
            cursor: text;
        }

        /* --- MODALS --- */
        #editor-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 5000;
            justify-content: center;
            align-items: center;
        }

        #editor-modal.active {
            display: flex;
        }

        .editor-box {
            background: white;
            width: 800px;
            max-width: 90%;
            height: 80vh;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .editor-header {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        #quill-container {
            flex: 1;
            overflow-y: auto;
        }

        .editor-footer {
            padding: 15px;
            border-top: 1px solid #ddd;
            text-align: right;
            background: #f8f9fa;
        }

        .editor-btn {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
            margin-right: 10px;
        }

        .btn-ok {
            background: var(--accent);
            color: white;
        }

        /* --- EXPORT MODAL --- */
        #export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            z-index: 6000;
            flex-direction: column;
        }

        #export-modal.active {
            display: flex;
        }

        .export-header {
            padding: 20px;
            background: #000;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .export-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .export-select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #222;
            color: white;
            font-size: 0.9rem;
        }

        .export-grid {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .export-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            opacity: 0.6;
            transition: 0.2s;
        }

        .export-item:hover {
            opacity: 1;
        }

        .export-item.selected {
            border-color: var(--accent);
            opacity: 1;
            transform: scale(0.95);
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.5);
        }

        .export-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .export-item .check-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .export-item.selected .check-icon {
            display: flex;
        }

        /* --- VIEW MODAL --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.open {
            display: flex;
        }

        .modal-card {
            background: white;
            width: 90%;
            height: 90%;
            display: flex;
            border-radius: 15px;
            overflow: hidden;
        }

        .modal-viz {
            flex: 2;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-viz img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .modal-text {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            border-left: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        .modal-card.text-only-mode .modal-viz {
            display: none;
        }

        .modal-card.text-only-mode .modal-text {
            flex: 1;
            padding: 60px;
            max-width: 800px;
            margin: 0 auto;
            border: none;
        }

        /* --- CONTROLS & TOAST --- */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        button.ctrl-btn {
            padding: 12px 24px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-edit {
            background: var(--primary);
            color: white;
        }

        .btn-save {
            background: var(--accent);
            color: white;
            display: block;
        }

        .btn-export {
            background: #8e44ad;
            color: white;
        }

        .btn-reset {
            background: #e67e22;
            color: white;
            font-size: 0.8rem;
            padding: 12px 15px !important;
        }

        #autosave-toast {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-left: 5px solid #2ecc71;
            max-width: 300px;
        }

        #autosave-toast.visible {
            opacity: 1;
        }

        .toast-title {
            font-weight: bold;
            color: #2ecc71;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toast-msg {
            font-size: 0.8rem;
            opacity: 0.9;
            color: #ddd;
        }
    </style>
</head>

<body class="" data-new-gr-c-s-check-loaded="9.96.0" data-gr-ext-installed="">

    <div id="autosave-toast" class="visible">
        <div class="toast-title"><span>üíæ</span> Autosaved (Browser)</div>
        <div class="toast-msg">Don't forget to click "Save &amp; Download" to create a permanent file!</div>
    </div>

    <div id="export-modal">
        <div class="export-header">
            <div>
                <h2 style="margin:0;">Gallery Studio</h2>
                <small style="color:#aaa;">Select images &amp; layout style</small>
            </div>
            <div class="export-controls">
                <select id="export-layout" class="export-select">
                    <option value="dynamic" selected="">Layout: Smart Mosaic (Flush Rows)</option>
                    <option value="uniform">Layout: Uniform Grid (Cropped)</option>
                </select>
                <button class="editor-btn btn-cancel" onclick="closeExportModal()">Close</button>
                <button class="editor-btn btn-ok" onclick="generateGallery()">‚¨áÔ∏è Download HTML</button>
            </div>
        </div>
        <div class="export-grid" id="export-grid-content"></div>
    </div>

    <div id="editor-modal" class="">
        <div class="editor-box">
            <div class="editor-header">
                <h3>Editing Text</h3>
            </div>
            <div id="quill-container" class=""><div class="ql-editor" data-gramm="false" contenteditable="true"><p>Charlotte Five Years Waterbody Shifts (2020-2024)</p></div><div class="ql-clipboard" contenteditable="true" tabindex="-1"></div><div class="ql-tooltip ql-hidden"><a class="ql-preview" target="_blank" href="about:blank"></a><input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL"><a class="ql-action"></a><a class="ql-remove"></a></div></div>
            <div class="editor-footer">
                <button class="editor-btn btn-cancel" onclick="closeEditor(false)">Cancel</button>
                <button class="editor-btn btn-ok" onclick="closeEditor(true)">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="profile-area" id="profile-container">
            <div class="avatar">
                <img id="avatar-img" src="IMG_1757.JPG" alt="Avatar">
                <label class="file-upload-overlay" style="cursor: pointer;">
                    Change <input type="file" hidden="" onchange="updateSrc(this, 'avatar-img')">
                </label>
            </div>
            <div class="editable-field" style="margin-top:10px; font-weight:bold; font-size:1.2rem;" onclick="openEditor(this)"><p><strong>Jayanta Biswas</strong></p></div>
            <div class="editable-field" style="font-size:0.9rem; opacity:0.8;" onclick="openEditor(this)">Spring
                Semester 2026</div>
        </div>
        <button class="nav-btn active" onclick="switchTab('gallery')">üìÖ Weekly Timeline</button>
        <button class="nav-btn" onclick="switchTab('maps')">üåç Final Maps</button>
        <button class="nav-btn" onclick="switchTab('about')">üë§ About Me</button>
    </div>

    <div class="main-content">
        <div id="gallery" class="page-section active">
            <h1 class="editable-field" onclick="openEditor(this)">Course Gallery</h1>
            <div id="timeline-container"><div class="week-block" id="week-1">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 1</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="test1.jpg" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>3D Visualization</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="test2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Beautiful Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="test3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>NC Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-2">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 2</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Week_2_Gemini_Generated_Image_1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Mapping Permanent Waterbodies Transition in Charlotte (Static Map)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p><strong>[ROLE]</strong> Act as a Lead Cartographer and Scientific Illustrator for a high-impact geospatial journal (e.g., IEEE TVCG or Cartography and Geographic Information Science).</p><p><strong>[GOAL]</strong> I need you to generate two high-fidelity demo images based on the project definition below. Do not write code. Do not write an essay. Generate the actual images. </p><p><strong>[PROJECT DEFINITION]</strong></p><p>‚Ä¢ Topic: Permanent waterbodies mapping</p><p>‚Ä¢ Title: Mapping Permanent Waterbodies Transition in Charlotte</p><p>‚Ä¢ Claim: Visualize how waterbodies increasing/decreasing over time and which area looses or gain waterbodies</p><p>‚Ä¢ Audience + Task: Urban Planners and Environmental Conservation Agencies</p><p>‚Ä¢ Data + License: Synthetic Aperture Radar (SAR) data from Sentinel-1 and Census Vector Polygon</p><p>‚Ä¢ Static Idea: Showing waterbody change map</p><p>‚Ä¢ Interactive Idea: Dynamic map how waterbodies decrease/increase over time</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Week_2_Gemini_Generated_Image_2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Mapping Permanent Waterbodies Transition in Charlotte (Interactive Map Snapshot)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p><strong>[ROLE]</strong> Act as a Lead Cartographer and Scientific Illustrator for a high-impact geospatial journal (e.g., IEEE TVCG or Cartography and Geographic Information Science).</p><p><strong>[GOAL]</strong> I need you to generate two high-fidelity demo images based on the project definition below. Do not write code. Do not write an essay. Generate the actual images. </p><p><strong>[PROJECT DEFINITION]</strong></p><p>‚Ä¢ Topic: Permanent waterbodies mapping</p><p>‚Ä¢ Title: Mapping Permanent Waterbodies Transition in Charlotte</p><p>‚Ä¢ Claim: Visualize how waterbodies increasing/decreasing over time and which area looses or gain waterbodies</p><p>‚Ä¢ Audience + Task: Urban Planners and Environmental Conservation Agencies</p><p>‚Ä¢ Data + License: Synthetic Aperture Radar (SAR) data from Sentinel-1 and Census Vector Polygon</p><p>‚Ä¢ Static Idea: Showing waterbody change map</p><p>‚Ä¢ Interactive Idea: Dynamic map how waterbodies decrease/increase over time</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Week_2_Gemini_Generated_Image_3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Map Peoples Movement using Ridesharing Services (Lime and Bird) in Atlanta (Static Map)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p><strong>[ROLE]</strong> Act as a Lead Cartographer and Scientific Illustrator for a high-impact geospatial journal (e.g., IEEE TVCG or Cartography and Geographic Information Science).</p><p><strong>[GOAL]</strong> I need you to generate two high-fidelity demo images based on the project definition below. Do not write code. Do not write an essay. Generate the actual images. </p><p><strong>[PROJECT DEFINITION]</strong></p><p>‚Ä¢ Topic: Transportation Micromobility</p><p>‚Ä¢ Title: Map Peoples Movement using Ridesharing Services (Lime and Bird) in Atlanta</p><p>‚Ä¢ Claim: Visualize people movement during different times and day</p><p>‚Ä¢ Audience + Task: Lime and Bird API (sharing live location of their bikes)</p><p>‚Ä¢ Data + License: Synthetic Aperture Radar (SAR) data from Sentinel-1 and Census Vector Polygon</p><p>‚Ä¢ Static Idea: Hotspot map showing where most of the people travel using these bikes </p><p>‚Ä¢ Interactive Idea: Dynamic map of people movement during different times and day</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Week_2_Gemini_Generated_Image_4.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Map Peoples Movement using Ridesharing Services (Lime and Bird) in Atlanta (Interactive Map Snapshot)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p><strong>[ROLE]</strong> Act as a Lead Cartographer and Scientific Illustrator for a high-impact geospatial journal (e.g., IEEE TVCG or Cartography and Geographic Information Science).</p><p><strong>[GOAL]</strong> I need you to generate two high-fidelity demo images based on the project definition below. Do not write code. Do not write an essay. Generate the actual images. </p><p><strong>[PROJECT DEFINITION]</strong></p><p>‚Ä¢ Topic: Transportation Micromobility</p><p>‚Ä¢ Title: Map Peoples Movement using Ridesharing Services (Lime and Bird) in Atlanta</p><p>‚Ä¢ Claim: Visualize people movement during different times and day</p><p>‚Ä¢ Audience + Task: Lime and Bird API (sharing live location of their bikes)</p><p>‚Ä¢ Data + License: Synthetic Aperture Radar (SAR) data from Sentinel-1 and Census Vector Polygon</p><p>‚Ä¢ Static Idea: Hotspot map showing where most of the people travel using these bikes </p><p>‚Ä¢ Interactive Idea: Dynamic map of people movement during different times and day</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-3">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 3</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="lab2_partA.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot Part A</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="lab2_partB.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot Part B</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="lab2_partC.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot Part C</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="lab2_partD.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot Part D</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Bad Map_Week3.jpg" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Bad Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Map Source: Carter Mayhew</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Good Map_Week3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Good Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Map Source: Carter Mayhew</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Short Reflection</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><ol><li><strong>Command not found (Typo error):</strong> go back and make sure I type the command name correctly.</li><li><strong>Problem during Conda install</strong>: forget to put -y during conda install and cannot put y/n during installation in Jupyter lab. I just interrupt the kernel and put -y and re-run the code.</li><li><strong>Package not found:</strong> use conda/pip command to install the package which was missing.</li><li><strong>Why does the environment matter?</strong></li></ol><ul><li class="ql-indent-1">Helps to avoid failure during moving code from one machine to another machine.</li><li class="ql-indent-1">Mitigate the package conflicts.</li><li class="ql-indent-1">Sometimes libraries get updates and it might change some functionalities that might conflict with previous versions. The environment helps us to maintain specific versions that we need for our geovisualization task.</li><li class="ql-indent-1">Helps to reproduce the work after months as the documented environment contains the specific version and packages required for the project.</li></ul><p><br></p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-4">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 4</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-1</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>EarthExplorer: Search Criteria page showing your AOI + date range.</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-2</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>EarthExplorer: Data Sets page showing the dataset(s) you selected (e.g., Landsat Collection 2 Level-2).</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-3</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>EarthExplorer: Results list showing at least one scene selected (include cloud cover/preview).</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S4.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-4</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>EarthExplorer: Download Options page (or your browser downloads list) showing the file is downloading or downloaded.</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S5.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-5</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>GEE access: Code Editor opens successfully OR a confirmation that your account is enabled (any clear proof).</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S6.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-6</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>JupyterLab: geemap map showing ROI + an imagery layer (e.g., Sentinel-2 RGB).</p><p><br></p><p>geemap.ee_initialize()</p><p># 1) ROI (edit if you want)</p><p>roi = ee.Geometry.Rectangle([-81.05, 35.10, -80.60, 35.45])</p><p># 2) Map</p><p>m = geemap.Map(center=[35.2271, -80.8431], zoom=10)</p><p>m.add_basemap("HYBRID")</p><p>m.addLayer(roi, {"color": "yellow"}, "ROI", True)</p><p># 3) Sentinel-2 SR (cloud-masked) with timestamp preserved</p><p>def mask_s2_sr(img):</p><p>&nbsp;scl = img.select("SCL")</p><p>&nbsp;mask = (scl.neq(3)</p><p>&nbsp;.And(scl.neq(8))</p><p>&nbsp;.And(scl.neq(9))</p><p>&nbsp;.And(scl.neq(10))</p><p>&nbsp;.And(scl.neq(11)))</p><p>&nbsp;out = img.updateMask(mask).divide(10000)</p><p>&nbsp;return out.copyProperties(img, img.propertyNames())</p><p>s2 = (ee.ImageCollection("COPERNICUS/S2_SR_HARMONIZED")</p><p>&nbsp;.filterBounds(roi)</p><p>&nbsp;.filterDate("2026-01-01", "2026-01-31")</p><p>&nbsp;.map(mask_s2_sr)</p><p>&nbsp;.filter(ee.Filter.notNull(["system:time_start"])))</p><p>s2_median = s2.median().clip(roi)</p><p>m.addLayer(s2_median, {"min": 0, "max": 0.3, "bands": ["B4","B3","B2"]}, "Sentinel-2 RGB")</p><p><br></p><p>m</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> ee
<span class="token keyword">import</span> geemap</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">ee<span class="token punctuation">.</span>Authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
ee<span class="token punctuation">.</span>Initialize<span class="token punctuation">(</span>project<span class="token operator">=</span><span class="token string">"ee-jayantakurp17"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># quick sanity check (should print a CRS string like 'EPSG:4326' or similar)</span>
img <span class="token operator">=</span> ee<span class="token punctuation">.</span>Image<span class="token punctuation">(</span><span class="token string">"USGS/SRTMGL1_003"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>projection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
inventory <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"USGS EarthExplorer"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Landsat C2 L2 (SR)"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"30m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check metadata"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"downloaded 1 scene"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"GEE (via geemap)"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Sentinel-2 SR Harmonized"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"10‚Äì20 m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check collection docs"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"NDVI + time series"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
inventory</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> geemap <span class="token keyword">import</span> chart

geemap<span class="token punctuation">.</span>ee_initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 1) ROI (edit if you want)</span>
roi <span class="token operator">=</span> ee<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">81.05</span><span class="token punctuation">,</span> <span class="token number">35.10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.60</span><span class="token punctuation">,</span> <span class="token number">35.45</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 2) Map</span>
m <span class="token operator">=</span> geemap<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">35.2271</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.8431</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span><span class="token string">"HYBRID"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>roi<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"yellow"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"ROI"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 3) Sentinel-2 SR (cloud-masked) with timestamp preserved</span>
<span class="token keyword">def</span> <span class="token function">mask_s2_sr</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
 scl <span class="token operator">=</span> img<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"SCL"</span><span class="token punctuation">)</span>
 mask <span class="token operator">=</span> <span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 out <span class="token operator">=</span> img<span class="token punctuation">.</span>updateMask<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>divide<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> out<span class="token punctuation">.</span>copyProperties<span class="token punctuation">(</span>img<span class="token punctuation">,</span> img<span class="token punctuation">.</span>propertyNames<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> <span class="token punctuation">(</span>ee<span class="token punctuation">.</span>ImageCollection<span class="token punctuation">(</span><span class="token string">"COPERNICUS/S2_SR_HARMONIZED"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterBounds<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterDate<span class="token punctuation">(</span><span class="token string">"2026-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2026-01-31"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>mask_s2_sr<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ee<span class="token punctuation">.</span>Filter<span class="token punctuation">.</span>notNull<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"system:time_start"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2_median <span class="token operator">=</span> s2<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clip<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>s2_median<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token string">"bands"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"B4"</span><span class="token punctuation">,</span><span class="token string">"B3"</span><span class="token punctuation">,</span><span class="token string">"B2"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Sentinel-2 RGB"</span><span class="token punctuation">)</span>

m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4) NDVI</span>
ndvi <span class="token operator">=</span> s2_median<span class="token punctuation">.</span>normalizedDifference<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"B8"</span><span class="token punctuation">,</span><span class="token string">"B4"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
ndvi_vis <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"palette"</span><span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">"#440154"</span><span class="token punctuation">,</span><span class="token string">"#3b528b"</span><span class="token punctuation">,</span><span class="token string">"#21918c"</span><span class="token punctuation">,</span><span class="token string">"#5ec962"</span><span class="token punctuation">,</span><span class="token string">"#fde725"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>ndvi<span class="token punctuation">,</span> ndvi_vis<span class="token punctuation">,</span> <span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_colorbar<span class="token punctuation">(</span>ndvi_vis<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">,</span> layer_name<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">eemap<span class="token punctuation">.</span>ee_export_image_to_drive<span class="token punctuation">(</span>
 image<span class="token operator">=</span>ndvi<span class="token punctuation">,</span>
 description<span class="token operator">=</span><span class="token string">"ndvi_demo_geovis"</span><span class="token punctuation">,</span>
 folder<span class="token operator">=</span><span class="token string">"geemap_exports"</span><span class="token punctuation">,</span>
 region<span class="token operator">=</span>roi<span class="token punctuation">,</span>
 scale<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
 maxPixels<span class="token operator">=</span><span class="token number">1e13</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Export task submitted. Check the Earth Engine Tasks tab."</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S7.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-7</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>JupyterLab: NDVI layer visible with a colorbar/legend.</p><p><br></p><p># 4) NDVI</p><p>ndvi = s2_median.normalizedDifference(["B8","B4"]).rename("NDVI")</p><p>ndvi_vis = {"min": 0, "max": 1, "palette":</p><p>["#440154","#3b528b","#21918c","#5ec962","#fde725"]}</p><p>m.addLayer(ndvi, ndvi_vis, "NDVI")</p><p>m.add_colorbar(ndvi_vis, label="NDVI", layer_name="NDVI")</p><p>m</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> ee
<span class="token keyword">import</span> geemap</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">ee<span class="token punctuation">.</span>Authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
ee<span class="token punctuation">.</span>Initialize<span class="token punctuation">(</span>project<span class="token operator">=</span><span class="token string">"ee-jayantakurp17"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># quick sanity check (should print a CRS string like 'EPSG:4326' or similar)</span>
img <span class="token operator">=</span> ee<span class="token punctuation">.</span>Image<span class="token punctuation">(</span><span class="token string">"USGS/SRTMGL1_003"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>projection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
inventory <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"USGS EarthExplorer"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Landsat C2 L2 (SR)"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"30m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check metadata"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"downloaded 1 scene"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"GEE (via geemap)"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Sentinel-2 SR Harmonized"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"10‚Äì20 m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check collection docs"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"NDVI + time series"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
inventory</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> geemap <span class="token keyword">import</span> chart

geemap<span class="token punctuation">.</span>ee_initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 1) ROI (edit if you want)</span>
roi <span class="token operator">=</span> ee<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">81.05</span><span class="token punctuation">,</span> <span class="token number">35.10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.60</span><span class="token punctuation">,</span> <span class="token number">35.45</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 2) Map</span>
m <span class="token operator">=</span> geemap<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">35.2271</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.8431</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span><span class="token string">"HYBRID"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>roi<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"yellow"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"ROI"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 3) Sentinel-2 SR (cloud-masked) with timestamp preserved</span>
<span class="token keyword">def</span> <span class="token function">mask_s2_sr</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
 scl <span class="token operator">=</span> img<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"SCL"</span><span class="token punctuation">)</span>
 mask <span class="token operator">=</span> <span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 out <span class="token operator">=</span> img<span class="token punctuation">.</span>updateMask<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>divide<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> out<span class="token punctuation">.</span>copyProperties<span class="token punctuation">(</span>img<span class="token punctuation">,</span> img<span class="token punctuation">.</span>propertyNames<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> <span class="token punctuation">(</span>ee<span class="token punctuation">.</span>ImageCollection<span class="token punctuation">(</span><span class="token string">"COPERNICUS/S2_SR_HARMONIZED"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterBounds<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterDate<span class="token punctuation">(</span><span class="token string">"2026-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2026-01-31"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>mask_s2_sr<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ee<span class="token punctuation">.</span>Filter<span class="token punctuation">.</span>notNull<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"system:time_start"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2_median <span class="token operator">=</span> s2<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clip<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>s2_median<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token string">"bands"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"B4"</span><span class="token punctuation">,</span><span class="token string">"B3"</span><span class="token punctuation">,</span><span class="token string">"B2"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Sentinel-2 RGB"</span><span class="token punctuation">)</span>

m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4) NDVI</span>
ndvi <span class="token operator">=</span> s2_median<span class="token punctuation">.</span>normalizedDifference<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"B8"</span><span class="token punctuation">,</span><span class="token string">"B4"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
ndvi_vis <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"palette"</span><span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">"#440154"</span><span class="token punctuation">,</span><span class="token string">"#3b528b"</span><span class="token punctuation">,</span><span class="token string">"#21918c"</span><span class="token punctuation">,</span><span class="token string">"#5ec962"</span><span class="token punctuation">,</span><span class="token string">"#fde725"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>ndvi<span class="token punctuation">,</span> ndvi_vis<span class="token punctuation">,</span> <span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_colorbar<span class="token punctuation">(</span>ndvi_vis<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">,</span> layer_name<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">eemap<span class="token punctuation">.</span>ee_export_image_to_drive<span class="token punctuation">(</span>
 image<span class="token operator">=</span>ndvi<span class="token punctuation">,</span>
 description<span class="token operator">=</span><span class="token string">"ndvi_demo_geovis"</span><span class="token punctuation">,</span>
 folder<span class="token operator">=</span><span class="token string">"geemap_exports"</span><span class="token punctuation">,</span>
 region<span class="token operator">=</span>roi<span class="token punctuation">,</span>
 scale<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
 maxPixels<span class="token operator">=</span><span class="token number">1e13</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Export task submitted. Check the Earth Engine Tasks tab."</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab3_S8.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Screenshot-8</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>JupyterLab: NDVI data export to google drive</p><p><br></p><p>eemap.ee_export_image_to_drive(</p><p>&nbsp;image=ndvi,</p><p>&nbsp;description="ndvi_demo_geovis",</p><p>&nbsp;folder="geemap_exports",</p><p>&nbsp;region=roi,</p><p>&nbsp;scale=20,</p><p>&nbsp;maxPixels=1e13,</p><p>)</p><p>print("Export task submitted. Check the Earth Engine Tasks tab.")</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> ee
<span class="token keyword">import</span> geemap</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">ee<span class="token punctuation">.</span>Authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span>
ee<span class="token punctuation">.</span>Initialize<span class="token punctuation">(</span>project<span class="token operator">=</span><span class="token string">"ee-jayantakurp17"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># quick sanity check (should print a CRS string like 'EPSG:4326' or similar)</span>
img <span class="token operator">=</span> ee<span class="token punctuation">.</span>Image<span class="token punctuation">(</span><span class="token string">"USGS/SRTMGL1_003"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>projection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>crs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getInfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
inventory <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"USGS EarthExplorer"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Landsat C2 L2 (SR)"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"30m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check metadata"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"downloaded 1 scene"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">"source"</span><span class="token punctuation">:</span> <span class="token string">"GEE (via geemap)"</span><span class="token punctuation">,</span>
            <span class="token string">"dataset"</span><span class="token punctuation">:</span> <span class="token string">"Sentinel-2 SR Harmonized"</span><span class="token punctuation">,</span>
            <span class="token string">"resolution"</span><span class="token punctuation">:</span> <span class="token string">"10‚Äì20 m"</span><span class="token punctuation">,</span>
            <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"check collection docs"</span><span class="token punctuation">,</span>
            <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string">"NDVI + time series"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
inventory</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> geemap <span class="token keyword">import</span> chart

geemap<span class="token punctuation">.</span>ee_initialize<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 1) ROI (edit if you want)</span>
roi <span class="token operator">=</span> ee<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">81.05</span><span class="token punctuation">,</span> <span class="token number">35.10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.60</span><span class="token punctuation">,</span> <span class="token number">35.45</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 2) Map</span>
m <span class="token operator">=</span> geemap<span class="token punctuation">.</span>Map<span class="token punctuation">(</span>center<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">35.2271</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.8431</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zoom<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span><span class="token string">"HYBRID"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>roi<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"yellow"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"ROI"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 3) Sentinel-2 SR (cloud-masked) with timestamp preserved</span>
<span class="token keyword">def</span> <span class="token function">mask_s2_sr</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
 scl <span class="token operator">=</span> img<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"SCL"</span><span class="token punctuation">)</span>
 mask <span class="token operator">=</span> <span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>And<span class="token punctuation">(</span>scl<span class="token punctuation">.</span>neq<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 out <span class="token operator">=</span> img<span class="token punctuation">.</span>updateMask<span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">.</span>divide<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> out<span class="token punctuation">.</span>copyProperties<span class="token punctuation">(</span>img<span class="token punctuation">,</span> img<span class="token punctuation">.</span>propertyNames<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> <span class="token punctuation">(</span>ee<span class="token punctuation">.</span>ImageCollection<span class="token punctuation">(</span><span class="token string">"COPERNICUS/S2_SR_HARMONIZED"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterBounds<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
 <span class="token punctuation">.</span>filterDate<span class="token punctuation">(</span><span class="token string">"2026-01-01"</span><span class="token punctuation">,</span> <span class="token string">"2026-01-31"</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>mask_s2_sr<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ee<span class="token punctuation">.</span>Filter<span class="token punctuation">.</span>notNull<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"system:time_start"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s2_median <span class="token operator">=</span> s2<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clip<span class="token punctuation">(</span>roi<span class="token punctuation">)</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>s2_median<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token string">"bands"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"B4"</span><span class="token punctuation">,</span><span class="token string">"B3"</span><span class="token punctuation">,</span><span class="token string">"B2"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Sentinel-2 RGB"</span><span class="token punctuation">)</span>

m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4) NDVI</span>
ndvi <span class="token operator">=</span> s2_median<span class="token punctuation">.</span>normalizedDifference<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"B8"</span><span class="token punctuation">,</span><span class="token string">"B4"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
ndvi_vis <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"min"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"max"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"palette"</span><span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">"#440154"</span><span class="token punctuation">,</span><span class="token string">"#3b528b"</span><span class="token punctuation">,</span><span class="token string">"#21918c"</span><span class="token punctuation">,</span><span class="token string">"#5ec962"</span><span class="token punctuation">,</span><span class="token string">"#fde725"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
m<span class="token punctuation">.</span>addLayer<span class="token punctuation">(</span>ndvi<span class="token punctuation">,</span> ndvi_vis<span class="token punctuation">,</span> <span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>add_colorbar<span class="token punctuation">(</span>ndvi_vis<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">,</span> layer_name<span class="token operator">=</span><span class="token string">"NDVI"</span><span class="token punctuation">)</span>
m</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">eemap<span class="token punctuation">.</span>ee_export_image_to_drive<span class="token punctuation">(</span>
 image<span class="token operator">=</span>ndvi<span class="token punctuation">,</span>
 description<span class="token operator">=</span><span class="token string">"ndvi_demo_geovis"</span><span class="token punctuation">,</span>
 folder<span class="token operator">=</span><span class="token string">"geemap_exports"</span><span class="token punctuation">,</span>
 region<span class="token operator">=</span>roi<span class="token punctuation">,</span>
 scale<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
 maxPixels<span class="token operator">=</span><span class="token number">1e13</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Export task submitted. Check the Earth Engine Tasks tab."</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Project_progress_2.JPG" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Project_progress_1.JPG" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Project_progress_3.JPG" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Project_progress_4.JPG" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-5">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 5</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab4_ss4.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Study area + clipped vector</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab4_ss3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Raster preview (band 1)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab4_ss2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Sampled points (value)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab4_ss1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Output Folder</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-6">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 6</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Importing Required Packages</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Checking CRS</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Univariate Choropleth Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_3_1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Univariate Choropleth Map with Base map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_4.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Bivariate Choropleth Map</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_4_1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Bivariate Choropleth Legend</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_5.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Cartograms</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Screenshot 2026-02-17 at 2.07.23‚ÄØPM.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Fallback: simple non-contiguous cartogram (scale polygons)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox" checked="checked"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> mapclassify  <span class="token comment"># required for scheme=... in GeoPandas plots</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"geopandas:"</span><span class="token punctuation">,</span> gpd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pandas:"</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"numpy:"</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"matplotlib:"</span><span class="token punctuation">,</span> matplotlib<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"mapclassify:"</span><span class="token punctuation">,</span> mapclassify<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd

gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/pop.gpkg"</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;-- change path</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>crs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Bounds:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">.</span>total_bounds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Columns:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>columns<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"POPULATION_2021"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>  <span class="token comment"># try: "EqualInterval", "FisherJenks", "Quantiles"</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Blues"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (FisherJenks, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Optional basemap (requires: contextily)</span>
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx

gdf_web <span class="token operator">=</span> gdf<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_web<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"FisherJenks"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Greens"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth + basemap: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">X <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
Y <span class="token operator">=</span> <span class="token string">"LAND_AREA_KM2"</span>  <span class="token comment"># &lt;-- change</span>
N <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># number of bins per variable (3 -&gt; 3x3)</span>
gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token comment"># Quantile bins (0..N-1). duplicates='drop' avoids errors if many ties.</span>
gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>X<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>qcut<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> duplicates<span class="token operator">=</span><span class="token string">"drop"</span><span class="token punctuation">)</span>
<span class="token comment"># Combine bins into one class ID (row-major)</span>
gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"y_bin"</span><span class="token punctuation">]</span> <span class="token operator">*</span> N <span class="token operator">+</span> gdf<span class="token punctuation">[</span><span class="token string">"x_bin"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 4x4 bivariate palette (row-major: y from low-&gt;high, x from low-&gt;high)</span>
palette <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"#e8e8e8"</span><span class="token punctuation">,</span> <span class="token string">"#b9dedd"</span><span class="token punctuation">,</span> <span class="token string">"#8ad4d3"</span><span class="token punctuation">,</span> <span class="token string">"#5ac8c8"</span><span class="token punctuation">,</span>
            <span class="token string">"#dabcd4"</span><span class="token punctuation">,</span> <span class="token string">"#b4b6cd"</span><span class="token punctuation">,</span> <span class="token string">"#8db0c7"</span><span class="token punctuation">,</span> <span class="token string">"#67aac0"</span><span class="token punctuation">,</span>
            <span class="token string">"#cc90c0"</span><span class="token punctuation">,</span> <span class="token string">"#ae8ec0"</span><span class="token punctuation">,</span> <span class="token string">"#908cbf"</span><span class="token punctuation">,</span> <span class="token string">"#738abe"</span><span class="token punctuation">,</span>
            <span class="token string">"#be64ac"</span><span class="token punctuation">,</span> <span class="token string">"#9265a4"</span><span class="token punctuation">,</span> <span class="token string">"#67679c"</span><span class="token punctuation">,</span> <span class="token string">"#3b4994"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">class_to_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"#dddddd"</span>
    <span class="token keyword">return</span> palette<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span>


gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> gdf<span class="token punctuation">[</span><span class="token string">"bi_class"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>class_to_color<span class="token punctuation">)</span>

ax <span class="token operator">=</span> gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>color<span class="token operator">=</span>gdf<span class="token punctuation">[</span><span class="token string">"bi_color"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Bivariate choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>X<span class="token punctuation">}</span></span><span class="token string"> (x) vs </span><span class="token interpolation"><span class="token punctuation">{</span>Y<span class="token punctuation">}</span></span><span class="token string"> (y)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>patches <span class="token keyword">import</span> Rectangle

fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> y <span class="token operator">*</span> N <span class="token operator">+</span> x
        ax<span class="token punctuation">.</span>add_patch<span class="token punctuation">(</span>Rectangle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span>palette<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_aspect<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>


<span class="token comment"># Minimal labeling (edit these to match your variables)</span>
ax<span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">3.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_yticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Low"</span><span class="token punctuation">,</span> <span class="token string">"Med"</span><span class="token punctuation">,</span> <span class="token string">"High"</span><span class="token punctuation">,</span> <span class="token string">"Very High"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span>X <span class="token operator">+</span> <span class="token string">" ‚Üí"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span>Y <span class="token operator">+</span> <span class="token string">" ‚Üë"</span><span class="token punctuation">)</span>

<span class="token comment"># Clean look</span>
<span class="token keyword">for</span> spine <span class="token keyword">in</span> ax<span class="token punctuation">.</span>spines<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    spine<span class="token punctuation">.</span>set_visible<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Bivariate legend (3x3)"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">CART_FIELD <span class="token operator">=</span> <span class="token string">"POP_DENSITY_PER_KM2"</span>  <span class="token comment"># &lt;-- change</span>
gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cartograms require positive values</span>
gdf <span class="token operator">=</span> gdf<span class="token punctuation">[</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Requires: pip install cartogram</span>
<span class="token keyword">import</span> cartogram
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

c <span class="token operator">=</span> cartogram<span class="token punctuation">.</span>Cartogram<span class="token punctuation">(</span>
    gdf<span class="token punctuation">,</span>
    CART_FIELD<span class="token punctuation">,</span>
    max_iterations<span class="token operator">=</span><span class="token number">99</span><span class="token punctuation">,</span>  <span class="token comment"># try: 30, 60, 99</span>
    max_average_error<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>  <span class="token comment"># try: 0.10 (faster) -&gt; 0.02 (more accurate)</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Average residual area error:"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>average_error<span class="token punctuation">)</span>
ax <span class="token operator">=</span> c<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Contiguous cartogram by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Optional export</span>
c<span class="token punctuation">.</span>to_file<span class="token punctuation">(</span><span class="token string">"geovis_labs/lab5/outputs/cartogram.gpkg"</span><span class="token punctuation">,</span> layer<span class="token operator">=</span><span class="token string">"cartogram"</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">"GPKG"</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> shapely<span class="token punctuation">.</span>affinity <span class="token keyword">import</span> scale

vals <span class="token operator">=</span> gdf<span class="token punctuation">[</span>CART_FIELD<span class="token punctuation">]</span><span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
factors <span class="token operator">=</span> <span class="token punctuation">(</span>vals <span class="token operator">/</span> np<span class="token punctuation">.</span>nanmean<span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># area is ~factor^2</span>
scaled_geoms <span class="token operator">=</span> <span class="token punctuation">[</span>
    scale<span class="token punctuation">(</span>geom<span class="token punctuation">,</span> xfact<span class="token operator">=</span>f<span class="token punctuation">,</span> yfact<span class="token operator">=</span>f<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">"center"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> geom<span class="token punctuation">,</span> f <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>gdf<span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> factors<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
gdf_scaled <span class="token operator">=</span> gdf<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
gdf_scaled<span class="token punctuation">[</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaled_geoms
gdf_scaled <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>set_geometry<span class="token punctuation">(</span><span class="token string">"geometry_scaled"</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> gdf_scaled<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>CART_FIELD<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"Quantiles"</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"Reds"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Non-contiguous cartogram (scaled) by </span><span class="token interpolation"><span class="token punctuation">{</span>CART_FIELD<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_6_1.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Questions-Answers</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_6_2.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Questions-Answers</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_6_3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Questions-Answers</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="Lab5_6_4.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Questions-Answers</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div><div class="week-block" id="week-7">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week 7</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üíª Labs &amp; Exercises</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìä Good vs Bad Viz</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üìñ Reading Reflections</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="text" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Reflections...</p></div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'text')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üöÄ Project Progress</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_historical_shift_map3.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Historical Waterbody Shifts (2001-2024)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper">
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [1]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> pygris <span class="token keyword">import</span> blocks
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> tifffile
<span class="token keyword">import</span> mapclassify
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> cx
<span class="token keyword">from</span> matplotlib_scalebar<span class="token punctuation">.</span>scalebar <span class="token keyword">import</span> ScaleBar</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [2]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 2. Load your Charlotte Census Tract Shapefile</span>
tracts <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'chalotte_blocks.gpkg'</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'total_wet_area_wide.csv'</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [3]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CRS:"</span><span class="token punctuation">,</span> tracts<span class="token punctuation">.</span>crs<span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [4]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">tracts <span class="token operator">=</span> tracts<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [5]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">tracts<span class="token punctuation">.</span>dtypes</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [6]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">tracts<span class="token punctuation">[</span><span class="token string">'GEOID'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tracts<span class="token punctuation">[</span><span class="token string">'GEOID'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [7]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">tracts<span class="token punctuation">.</span>dtypes</code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [8]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">tracts<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [9]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [10]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">merged <span class="token operator">=</span> tracts<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df<span class="token punctuation">,</span> left_on<span class="token operator">=</span><span class="token string">'GEOID'</span><span class="token punctuation">,</span> right_on<span class="token operator">=</span><span class="token string">'GEOID20'</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [11]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">merged<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [12]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2001"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2001'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2002"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2002'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2003"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2003'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2004"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2004'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2005"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2005'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2006"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2006'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2007"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2007'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2008"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2008'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2009"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2009'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2010"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2010'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2011"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2011'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2012"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2012'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2013"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2013'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2014"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2014'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2015"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2015'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2016"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2016'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2017"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2017'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2018"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2018'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2019"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2019'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2020"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2020'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2021"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2021'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2022"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2022'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2023"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2023'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span>
merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2024"</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>merged<span class="token punctuation">[</span><span class="token string">'2024'</span><span class="token punctuation">]</span><span class="token operator">/</span>merged<span class="token punctuation">[</span><span class="token string">'Area'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [13]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">merged<span class="token punctuation">[</span><span class="token string">"Historical_Shift_2001_2024"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2001"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2024"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2001_2002"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2001"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2002"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2002_2003"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2002"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2003"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2003_2004"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2003"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2004"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2004_2005"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2004"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2005"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2005_2006"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2005"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2006"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2006_2007"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2006"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2007"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2007_2008"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2007"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2008"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2008_2009"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2008"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2009"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2009_2010"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2009"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2010"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2010_2011"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2010"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2011"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2011_2012"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2011"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2012"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2012_2013"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2012"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2013"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2013_2014"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2013"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2014"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2014_2015"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2014"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2015"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2015_2016"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2015"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2016"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2016_2017"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2016"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2017"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2017_2018"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2017"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2018"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2018_2019"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2018"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2019"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2019_2020"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2019"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2020"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2020_2021"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2020"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2021"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2021_2022"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2021"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2022"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2022_2023"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2022"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2023"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Yearly_Shift_2023_2024"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2023"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2024"</span><span class="token punctuation">]</span>


merged<span class="token punctuation">[</span><span class="token string">"Five_Years_Shift_2001_2005"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2001"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2005"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Five_Years_Shift_2005_2010"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2005"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2010"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Five_Years_Shift_2010_2015"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2010"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2015"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Five_Years_Shift_2015_2020"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2015"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2020"</span><span class="token punctuation">]</span>
merged<span class="token punctuation">[</span><span class="token string">"Five_Years_Shift_2020_2024"</span><span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2020"</span><span class="token punctuation">]</span><span class="token operator">-</span>merged<span class="token punctuation">[</span><span class="token string">"Area_PCT_2024"</span><span class="token punctuation">]</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [14]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">merged<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [15]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">VAR <span class="token operator">=</span> <span class="token string">"Historical_Shift_2001_2024"</span> <span class="token comment"># &lt;-- change</span>
merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">"coerce"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Missing values:"</span><span class="token punctuation">,</span> merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [16]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># 1. Replace 'inf' values with NaN so they don't break the classification</span>
<span class="token comment"># We also handle -inf just in case</span>
merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span> <span class="token operator">=</span> merged<span class="token punctuation">[</span>VAR<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>inf<span class="token punctuation">,</span> <span class="token operator">-</span>np<span class="token punctuation">.</span>inf<span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span>

<span class="token comment"># 2. Create the plot with 'missing_kwds'</span>
ax <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
    column<span class="token operator">=</span>VAR<span class="token punctuation">,</span>
    scheme<span class="token operator">=</span><span class="token string">"EqualInterval"</span><span class="token punctuation">,</span> 
    k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    cmap<span class="token operator">=</span><span class="token string">"managua"</span><span class="token punctuation">,</span>
    linewidth<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>
    edgecolor<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
    legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"loc"</span><span class="token punctuation">:</span> <span class="token string">"upper left"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># This block handles the NaN / Inf values</span>
    missing_kwds<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"lightgrey"</span><span class="token punctuation">,</span>   <span class="token comment"># Color for tracts with no data/inf</span>
        <span class="token string">"edgecolor"</span><span class="token punctuation">:</span> <span class="token string">"white"</span><span class="token punctuation">,</span>   <span class="token comment"># Border color</span>
        <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"New Water / No Previous Water"</span><span class="token punctuation">,</span> <span class="token comment"># Label in legend</span>
        <span class="token string">"hatch"</span><span class="token punctuation">:</span> <span class="token string">"///"</span>          <span class="token comment"># Optional: adds a pattern to distinguish</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Choropleth: </span><span class="token interpolation"><span class="token punctuation">{</span>VAR<span class="token punctuation">}</span></span><span class="token string"> (EqualInterval, k=5)"</span></span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_axis_off<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Move the legend to a better position if needed</span>
leg <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> leg<span class="token punctuation">:</span>
    leg<span class="token punctuation">.</span>set_bbox_to_anchor<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.15</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [17]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Historical_Shift_2001_2024'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2001-2024)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Historical Shift: Charlotte Water &amp; Wetland Coverage (2001-2024)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_historical_shift_map3.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [18]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Five_Years_Shift_2001_2005'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2001-2005)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Five Years Shift: Charlotte Water &amp; Wetland Coverage (2001-2005)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_five_years_shift_01_05.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [19]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Five_Years_Shift_2005_2010'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2005-2010)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Five Years Shift: Charlotte Water &amp; Wetland Coverage (2005-2010)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_five_years_shift_05_10.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [20]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Five_Years_Shift_2010_2015'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2010-2015)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Five Years Shift: Charlotte Water &amp; Wetland Coverage (2010-2015)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_five_years_shift_10_15.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [21]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Five_Years_Shift_2015_2020'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2015-2020)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Five Years Shift: Charlotte Water &amp; Wetland Coverage (2015-2020)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_five_years_shift_15_20.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [22]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 1. Plotting the percentage change</span>
plot <span class="token operator">=</span> merged<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'Five_Years_Shift_2020_2024'</span><span class="token punctuation">,</span> 
                   cmap<span class="token operator">=</span><span class="token string">'RdYlGn'</span><span class="token punctuation">,</span> 
                   ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> 
                   legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                   vmin<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># Focus on significant changes</span>
                   legend_kwds<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'label'</span><span class="token punctuation">:</span> <span class="token string">"% Change in Water/Wetland Area (2020-2024)"</span><span class="token punctuation">,</span>
                                <span class="token string">'orientation'</span><span class="token punctuation">:</span> <span class="token string">"horizontal"</span><span class="token punctuation">,</span>
                                <span class="token string">'pad'</span><span class="token punctuation">:</span> <span class="token number">0.02</span><span class="token punctuation">,</span>
                                <span class="token string">'shrink'</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 2. Add Basemap</span>
<span class="token comment"># We use CartoDB Positron for a clean, light background that makes colors pop</span>
cx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> source<span class="token operator">=</span>cx<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>CartoDB<span class="token punctuation">.</span>Positron<span class="token punctuation">)</span>

<span class="token comment"># Set title and turn off standard axes</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Five Years Shift: Charlotte Water &amp; Wetland Coverage (2020-2024)"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">,</span> pad<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. Add North Arrow (Top Right)</span>
xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_xlim<span class="token punctuation">(</span><span class="token punctuation">)</span>
ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> ax<span class="token punctuation">.</span>get_ylim<span class="token punctuation">(</span><span class="token punctuation">)</span>

scale_length_meters <span class="token operator">=</span> <span class="token number">5000</span>

<span class="token comment"># Position it in the bottom right corner</span>
x_start <span class="token operator">=</span> xmax <span class="token operator">-</span> <span class="token number">6000</span>  
y_start <span class="token operator">=</span> ymin <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">)</span> 
tick_height <span class="token operator">=</span> <span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.015</span> 

<span class="token comment"># Draw the main horizontal line (total length = 4000 meters / 4 km)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_start<span class="token punctuation">,</span> x_start <span class="token operator">+</span> <span class="token number">4000</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start<span class="token punctuation">,</span> y_start<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Define the sections in kilometers</span>
sections_km <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Loop through each section to draw a vertical tick and a label</span>
<span class="token keyword">for</span> km <span class="token keyword">in</span> sections_km<span class="token punctuation">:</span>
    x_pos <span class="token operator">=</span> x_start <span class="token operator">+</span> <span class="token punctuation">(</span>km <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment"># Convert km to meters</span>
    
    <span class="token comment"># Draw vertical tick mark</span>
    ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x_pos<span class="token punctuation">,</span> x_pos<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y_start <span class="token operator">-</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Label the tick mark (add "km" only to the last label)</span>
    label <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string"> km"</span></span> <span class="token keyword">if</span> km <span class="token operator">==</span> <span class="token number">4</span> <span class="token keyword">else</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>km<span class="token punctuation">}</span></span><span class="token string">"</span></span>
    ax<span class="token punctuation">.</span>text<span class="token punctuation">(</span>x_pos<span class="token punctuation">,</span> y_start <span class="token operator">+</span> tick_height<span class="token operator">/</span><span class="token number">1.5</span><span class="token punctuation">,</span> label<span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> va<span class="token operator">=</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">#fontweight='bold')</span>

<span class="token comment"># 5. Add Data Source (Bottom Left below the map)</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.14</span><span class="token punctuation">,</span> 
            <span class="token string">"Data Source: Multi-Resolution Land Characteristics (MRLC) NLCD 2001-2024"</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>

<span class="token comment"># 6. Add Limitations</span>
plt<span class="token punctuation">.</span>figtext<span class="token punctuation">(</span><span class="token number">0.16</span><span class="token punctuation">,</span> <span class="token number">0.11</span><span class="token punctuation">,</span> 
            <span class="token string">"Limitations: Based on 30m resolution satellite imagery. Small-scale or highly localized\n"</span>
            <span class="token string">"changes (e.g., minor stream realignments) may not be fully captured."</span><span class="token punctuation">,</span> 
            ha<span class="token operator">=</span><span class="token string">"left"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">)</span>


<span class="token comment"># Adjust spacing between the map and the plot so they don't overlap</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span>rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.08</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Save and show</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'clt_five_years_shift_20_24.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
                                            </div>
                                        </div>
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [23]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre class="language-python" tabindex="0"><code class="language-python"></code></pre>
                                            </div>
                                        </div></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_five_years_shift_01_05.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Five Years Waterbody Shifts (2001-2005)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_five_years_shift_05_10.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Five Years Waterbody Shifts (2005-2010)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_five_years_shift_10_15.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Five Years Waterbody Shifts (2010-2015)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_five_years_shift_15_20.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Five Years Waterbody Shifts (2015-2020)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="clt_five_years_shift_20_24.png" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)"><p>Charlotte Five Years Waterbody Shifts (2020-2024)</p></h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
                <div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">üí¨ Peer Review &amp; Extras</div>
                <div class="gallery-grid"><div class="gallery-item" data-type="standard" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                <div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden="" onchange="updateCardImage(this)"></label>
                   </div>
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>Description...</p></div>
                    
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    
                    <div class="notebook-wrapper"></div>
                </div>
            </div></div>
                <div class="add-area-small" onclick="addGalleryItem(this, 'standard')">+ Add Item</div>
            </div>
            </div></div>
            <div class="add-area-big" onclick="addWeek()">
                <h2>+ Add New Week</h2>
            </div>
        </div>

        <div id="maps" class="page-section">
            <h1 class="editable-field" onclick="openEditor(this)">Interactive Maps</h1>
            <div id="maps-container"></div>
            <div class="add-area-big" onclick="addMapItem()">
                <h2>+ Add New Map Section</h2>
            </div>
        </div>

        <div id="about" class="page-section">
            <h1 class="editable-field" onclick="openEditor(this)">About Me</h1>
            <div id="about-container" class="editable-field desc-text" onclick="openEditor(this)"><p>I have completed my bachelor and master degree in Urban and Rural Planning Discipline at Khulna University also got my second master degree in MS in Earth Sciences from University of Memphis. At present, I am pursing my Doctoral Degree in PhD in Geography at the University of North Carolina at Charlotte.</p><p>I love to work with geospatial data. I want to unfold different real worlds problems with the help of geospatial and statistical methods. In this&nbsp;<a href="https://biswasjayanta.github.io/" target="_blank" style="color: rgb(9, 105, 218); background-color: rgba(0, 0, 0, 0);">Github page</a>, you will find different real worlds problem that I have been tried to solve with the help of Python programming language and it's packages.</p><p><br></p><h3>Education</h3><ul><li>PhD in Geography, University of North Carolina at Charlotte, Jan 2026 - Present</li><li>M.S. in Earth Sciences, The University of Memphis, Jan 2024 ‚Äì Dec 2025</li><li>Master of Urban and Rural Planning, Khulna University, Jul 2022 ‚Äì Jan 2024</li><li>Bachelor of Urban and Rural Planning, Khulna University, Jan 2017 ‚Äì Mar 2022</li><li>Graduate GIS Certificate, The University of Memphis, Apr 2025 - Dec 2025
                </li></ul><p><br></p><p>Jayanta Biswas</p><p>Major: PhD in Geography</p><p>Expectation: Learn how to make good maps using open-source data and coding.</p><p>Visualization Tools: ArcGIS Pro, QGIS, PowerPoint, Illustrator</p><p>Intended Use: Academic Journal and Dissertations</p><p>
            </p></div>
        </div>
    </div>

    <div class="modal-overlay" id="vizModal" onclick="closeModal()">
        <div class="close-btn" onclick="closeModal()">√ó</div>
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-viz"><img id="modal-img" src="https://biswasjayanta.github.io/Lab3_S7.png"></div>
            <div class="modal-text">
                <h2 id="modal-title" style="margin-top:0;">Screenshot-7</h2>
                <div id="modal-desc" class="desc-text"><p>JupyterLab: NDVI layer visible with a colorbar/legend.</p><p><br></p><p># 4) NDVI</p><p>ndvi = s2_median.normalizedDifference(["B8","B4"]).rename("NDVI")</p><p>ndvi_vis = {"min": 0, "max": 1, "palette":</p><p>["#440154","#3b528b","#21918c","#5ec962","#fde725"]}</p><p>m.addLayer(ndvi, ndvi_vis, "NDVI")</p><p>m.add_colorbar(ndvi_vis, label="NDVI", layer_name="NDVI")</p><p>m</p></div>
                <div id="modal-notebook-area" style="display: block; margin-top: 20px; border-top-width: 1px; border-top-style: solid; border-top-color: rgb(238, 238, 238); padding-top: 20px;">
                    <h4 style="margin:0 0 10px 0;">Notebook Source:</h4>
                    <div id="modal-notebook-content" class="notebook-wrapper visible"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="ctrl-btn btn-reset" onclick="resetLocalData()">‚ö†Ô∏è Reset</button>
        <button class="ctrl-btn btn-export" onclick="openExportModal()">‚ú® Export Gallery</button>
        <button class="ctrl-btn btn-edit" onclick="toggleEdit()" style="background: rgb(26, 26, 26);">‚úèÔ∏è Edit Mode</button>
        <button class="ctrl-btn btn-save" onclick="saveFile()">üíæ Save &amp; Download</button>
    </div>

    <script>
        let isEditing = false;
        let quill;
        let currentEditElement = null;

        // ===============================
        // FIXED: Stable autosave per file + unsaved changes warning
        // ===============================
        let dirtySinceManualSave = false;

        function generateId() {
            return (window.crypto && crypto.randomUUID)
                ? crypto.randomUUID()
                : ("id-" + Date.now() + "-" + Math.random().toString(16).slice(2));
        }

        // Stable mapping: same file (same URL) -> same portfolio-id
        function getUrlIdKey() {
            return `portfolio_id_by_url__${window.location.href}`;
        }

        function getOrCreateStableIdForThisFile() {
            const k = getUrlIdKey();
            let id = localStorage.getItem(k);
            if (!id) {
                id = generateId();
                localStorage.setItem(k, id);
            }
            return id;
        }

        function getPortfolioId() {
            let meta = document.querySelector('meta[name="portfolio-id"]');
            if (!meta) {
                meta = document.createElement('meta');
                meta.name = "portfolio-id";
                document.head.appendChild(meta);
            }

            const metaVal = (meta.content || "").trim();

            // If meta is empty, hydrate from stable per-file id
            if (!metaVal) {
                meta.content = getOrCreateStableIdForThisFile();
            } else {
                // If meta has an id, keep it as the canonical id for this file URL
                localStorage.setItem(getUrlIdKey(), metaVal);
            }

            return (meta.content || "").trim();
        }

        function getStorageKey() {
            return `portfolio_backup__${getPortfolioId()}`;
        }

        function markDirty() {
            dirtySinceManualSave = true;
        }

        window.onload = function () {
            quill = new Quill('#quill-container', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                        ['link', 'clean']
                    ]
                }
            });

            const hasRestored = restoreLocalData();
            if (!hasRestored && document.getElementById('timeline-container').children.length === 0) {
                addWeek();
            }
            Prism.highlightAll();
            setInterval(saveLocalData, 30000);

            // warn on close/refresh if changes since last manual download
            window.addEventListener('beforeunload', (e) => {
                if (dirtySinceManualSave) {
                    e.preventDefault();
                    e.returnValue = "";
                }
            });
        };

        // --- AUTOSAVE LOGIC (PER-FILE KEY) ---
        function saveLocalData() {
            const data = {
                timeline: document.getElementById('timeline-container').innerHTML,
                maps: document.getElementById('maps-container').innerHTML,
                about: document.getElementById('about-container').innerHTML,
                profile: document.getElementById('profile-container').innerHTML
            };
            localStorage.setItem(getStorageKey(), JSON.stringify(data));

            const toast = document.getElementById('autosave-toast');
            toast.classList.add('visible');
            setTimeout(() => toast.classList.remove('visible'), 5000);
        }

        function restoreLocalData() {
            const stored = localStorage.getItem(getStorageKey());
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    document.getElementById('timeline-container').innerHTML = data.timeline || "";
                    document.getElementById('maps-container').innerHTML = data.maps || "";
                    document.getElementById('about-container').innerHTML = data.about || "";
                    document.getElementById('profile-container').innerHTML = data.profile || "";
                    return true;
                } catch (e) { console.error("Error restoring data", e); }
            }
            return false;
        }

        function resetLocalData() {
            if (confirm("‚ö†Ô∏è Are you sure you want to clear autosave data for THIS HTML file? This will revert the page to default on reload.")) {
                localStorage.removeItem(getStorageKey());
                location.reload();
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- EDITOR LOGIC ---
        function openEditor(element) {
            if (!isEditing) return;
            currentEditElement = element;
            quill.root.innerHTML = element.innerHTML;
            document.getElementById('editor-modal').classList.add('active');
        }

        function closeEditor(save) {
            if (save && currentEditElement) {
                currentEditElement.innerHTML = quill.root.innerHTML;
                markDirty();
                saveLocalData();
            }
            document.getElementById('editor-modal').classList.remove('active');
            currentEditElement = null;
        }

        // --- EXPORT GALLERY LOGIC (WITH SMART MOSAIC) ---
        function openExportModal() {
            const grid = document.getElementById('export-grid-content');
            grid.innerHTML = '';
            const images = document.querySelectorAll('.gallery-item[data-type="standard"]');

            images.forEach((item) => {
                const imgEl = item.querySelector('.viz-source');
                const title = item.querySelector('.item-title').innerText;
                const thumb = document.createElement('div');
                thumb.className = 'export-item';
                thumb.onclick = function () { this.classList.toggle('selected'); };

                thumb.innerHTML = `<img src="${imgEl.src}"><div class="check-icon">‚úì</div><div style="position:absolute; bottom:0; background:rgba(0,0,0,0.7); color:white; width:100%; font-size:0.8rem; padding:5px; box-sizing:border-box;">${title}</div>`;

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const imgObj = new Image();
                imgObj.crossOrigin = "Anonymous";
                imgObj.src = imgEl.src;

                thumb.dataset.title = title;
                thumb.dataset.desc = item.querySelector('.desc-text').innerHTML;
                thumb.dataset.originalSrc = imgEl.src;
                thumb.dataset.exportSrc = imgEl.src;
                thumb.dataset.ratio = 1.5;

                imgObj.onload = function () {
                    thumb.dataset.ratio = imgObj.width / imgObj.height;
                    canvas.width = imgObj.width;
                    canvas.height = imgObj.height;
                    ctx.drawImage(imgObj, 0, 0);
                    try { thumb.dataset.exportSrc = canvas.toDataURL('image/png'); } catch (e) { }
                }

                grid.appendChild(thumb);
            });
            document.getElementById('export-modal').classList.add('active');
        }

        function closeExportModal() { document.getElementById('export-modal').classList.remove('active'); }

        function generateGallery() {
            
            const selectedItems = document.querySelectorAll('.export-item.selected');
            if (selectedItems.length === 0) { alert("Please select at least one image."); return; }

            const layoutType = document.getElementById('export-layout').value;

            let galleryItemsHTML = '';
            const baseHeight = 400;

            selectedItems.forEach((item, index) => {
                const imgSrc = item.dataset.exportSrc || item.dataset.originalSrc;
                let styleStr = '';

                if (layoutType === 'dynamic') {
                    const ratio = parseFloat(item.dataset.ratio) || 1.5;
                    const growFactor = ratio * 100;
                    const flexBasis = Math.floor(baseHeight * ratio);
                    styleStr = `style="flex-grow: ${growFactor}; flex-basis: ${flexBasis}px;"`;
                }
                const fileName = imgSrc.split('/').pop().split('?')[0].split('#')[0];
                galleryItemsHTML += `
                <div class="card gallery-card" id="card-${index}" data-img="${fileName}" ${styleStr}>
                    <div class="card-inner">
                        <img src="${fileName}" alt="Gallery Image">
                        <div class="card-content">
                            <h3>${item.dataset.title}</h3>
                            <div class="desc">${item.dataset.desc}</div>
                        </div>
                    </div>
                </div>`;
            });

            let containerCSS = '';
            let cardCSS = '';

            if (layoutType === 'uniform') {
                containerCSS = `display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 40px;`;
                cardCSS = `height: 400px; width: 100%;`;
            } else {
                containerCSS = `display: flex; flex-wrap: wrap; gap: 20px;`;
                cardCSS = `height: 40vh; min-height: 400px; max-width: 100%; position: relative;`;
            }

            const newFileContent = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Immersive Gallery</title>
<style>
    :root { --dark: #111; --light: #eee; --accent: #27ae60; }
    body { background-color: var(--dark); color: var(--light); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 40px; overflow-x: hidden; perspective: 1000px; }
    .noise { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; opacity: 0.07; background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJnoiPjxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjY1IiBudW1PY3RhdmVzPSIzIiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI2cpIiBvcGFjaXR5PSIxIi8+PC9zdmc+'); }
    h1 { text-align: center; font-weight: 300; letter-spacing: 5px; margin-bottom: 60px; text-transform: uppercase; font-size: 3rem; text-shadow: 0 0 20px rgba(255,255,255,0.3); position: relative; z-index: 20; }
    .gallery-container { ${containerCSS} max-width: 1600px; margin: 0 auto; position: relative; z-index: 20; }
    .gallery-container::after { content: ''; flex-grow: 999999999; min-width: 200px; height: 0; }
    .card { ${cardCSS} background: transparent; perspective: 1000px; cursor: pointer; border-radius: 8px; overflow: hidden; }
    .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); transform-style: preserve-3d; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .card:hover .card-inner { transform: scale(0.98); box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
    .card img { width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(0.9) contrast(1.1); transition: 0.5s; }
    .card:hover img { filter: brightness(1); transform: scale(1.02); }
    .card-content { position: absolute; bottom: 0; left: 0; width: 100%; padding: 25px; box-sizing: border-box; background: linear-gradient(to top, black 20%, transparent 100%); transform: translateZ(30px); opacity: 0; transition: 0.4s; pointer-events: none; }
    .card:hover .card-content { opacity: 1; transform: translateZ(50px) translateY(-10px); }
    h3 { margin: 0 0 5px 0; color: #fff; font-size: 1.4rem; letter-spacing: 1px; }
    .desc { font-size: 0.9rem; color: #ccc; max-height: 80px; overflow: hidden; }
    #lightbox { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
    #lightbox.active { display: flex; opacity: 1; }
    .lb-content { width: 90vw; height: 85vh; background: #1a1a1a; border-radius: 12px; display: flex; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.8); border: 1px solid #333; position: relative; }
    .lb-image-container { flex: 2; background: #000; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .lb-image-container img { max-width: 100%; max-height: 100%; object-fit: contain; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    .lb-text-container { flex: 1; padding: 40px; overflow-y: auto; border-left: 1px solid #333; display: flex; flex-direction: column; }
    .lb-title { font-size: 2rem; margin-top: 0; color: var(--accent); margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
    .lb-desc { font-size: 1.1rem; line-height: 1.6; color: #ddd; }
    .lb-desc p { margin-bottom: 1em; }
    .close-lb { position: absolute; top: 20px; right: 20px; color: white; font-size: 2.5rem; cursor: pointer; user-select: none; z-index: 100; line-height: 1; }
    .close-lb:hover { color: #e74c3c; transform: scale(1.1); transition: 0.2s; }
    @media (max-width: 900px) { .lb-content { flex-direction: column; height: 90vh; } .lb-image-container { flex: 1; } .lb-text-container { flex: 1; padding: 20px; } }
</style>
</head>
<body>
    <div class="noise"></div>
    <h1>Visuals & Reflections</h1>
    <div class="gallery-container">${galleryItemsHTML}</div>
    <div id="lightbox">
        <div class="lb-content">
            <div class="close-lb" id="close-btn">&times;</div>
            <div class="lb-image-container"><img id="lb-img" src=""></div>
            <div class="lb-text-container"><h2 id="lb-title" class="lb-title"></h2><div id="lb-desc" class="lb-desc"></div></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.gallery-card');
            const lightbox = document.getElementById('lightbox');
            const closeBtn = document.getElementById('close-btn');
            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const imgSrc = card.getAttribute('data-img');
                    const title = card.querySelector('h3').innerText;
                    const desc = card.querySelector('.desc').innerHTML;
                    document.getElementById('lb-img').src = imgSrc;
                    document.getElementById('lb-title').innerText = title;
                    document.getElementById('lb-desc').innerHTML = desc;
                    lightbox.classList.add('active');
                });
            });
            closeBtn.addEventListener('click', () => lightbox.classList.remove('active'));
            lightbox.addEventListener('click', (e) => { if(e.target === lightbox) lightbox.classList.remove('active'); });
        });
    <\/script>
</body>
</html>`;

            const blob = new Blob([newFileContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "GeoViz_Showcase.html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // --- EXISTING UTILS ---
        function createCategory(title, type) {
            return `<div class="category-section">
                <div class="category-title editable-field" onclick="openEditor(this)">${title}</div>
                <div class="gallery-grid"></div>
                <div class="add-area-small" onclick="addGalleryItem(this, '${type}')">+ Add Item</div>
            </div>`;
        }

        function addWeek() {
            const weekNum = document.querySelectorAll('.week-block').length + 1;
            const weekId = 'week-' + weekNum;
            const weekTemplate = `<div class="week-block" id="${weekId}">
                <div class="week-header">
                    <h2 class="editable-field" onclick="openEditor(this)">Week ${weekNum}</h2>
                    <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Week</button>
                </div>
                ${createCategory("üíª Labs & Exercises", "standard")}
                ${createCategory("üìä Good vs Bad Viz", "standard")}
                ${createCategory("üìñ Reading Reflections", "text")}
                ${createCategory("üöÄ Project Progress", "standard")}
                ${createCategory("üí¨ Peer Review & Extras", "standard")}
            </div>`;
            document.getElementById('timeline-container').insertAdjacentHTML('beforeend', weekTemplate);

            const newWeek = document.getElementById('timeline-container').lastElementChild;
            newWeek.querySelectorAll('.add-area-small').forEach(btn => {
                const type = btn.getAttribute('onclick').includes("'text'") ? 'text' : 'standard';
                addGalleryItem(btn, type);
            });

            markDirty();
            saveLocalData();
        }

        function addGalleryItem(btnElement, type) {
            const targetGrid = btnElement.previousElementSibling;
            let imagePart = type === 'standard'
                ? `<div class="img-container">
                        <img class="viz-source" src="https://via.placeholder.com/600x400" alt="Viz">
                        <label class="file-upload-overlay">Change Img <input type="file" hidden onchange="updateCardImage(this)"></label>
                   </div>`
                : '';

            const template = `<div class="gallery-item" data-type="${type}" onclick="openModal(this)">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è</button>
                ${imagePart}
                <div class="item-data" onclick="if (isEditing) event.stopPropagation()">
                    <h3 class="editable-field item-title" onclick="openEditor(this)">Title</h3>
                    <div class="editable-field desc-text" onclick="openEditor(this)"><p>${type === 'text' ? 'Reflections...' : 'Description...'}</p></div>
                    ${type === 'standard' ? `
                        <div class="code-controls">
                            <div class="switch-wrapper">
                                <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                                <span>Show NB in Modal</span>
                            </div>
                            <div class="upload-area"><input type="file" accept=".ipynb,.py" onchange="handleNotebookUpload(this)"></div>
                        </div>
                    ` : ''}
                    <div class="notebook-wrapper"></div>
                </div>
            </div>`;

            targetGrid.insertAdjacentHTML('beforeend', template);
            Prism.highlightAll();

            markDirty();
            saveLocalData();
        }

        function addMapItem() {
            const template = `<div class="map-wrapper">
                <button class="delete-btn" onclick="deleteElement(this, event)">üóëÔ∏è Delete Section</button>
                <h2 class="editable-field" onclick="openEditor(this)">New Map Title</h2>
                <div class="html-container">
                    <iframe src="about:blank"></iframe>
                    <label class="file-upload-overlay">
                        <div><h3>Select HTML File</h3><input type="file" onchange="updateMapFrame(this)"></div>
                    </label>
                </div>
                <div class="editable-field desc-text" onclick="openEditor(this)">Description...</div>
            </div>`;
            document.getElementById('maps-container').insertAdjacentHTML('beforeend', template);

            markDirty();
            saveLocalData();
        }

        function handleNotebookUpload(input) {
            const file = input.files[0];
            const wrapper = input.closest('.item-data').querySelector('.notebook-wrapper');
            const reader = new FileReader();
            reader.onload = function (e) {
                let content = e.target.result;
                wrapper.innerHTML = "";

                if (file.name.endsWith('.ipynb')) {
                    try {
                        const json = JSON.parse(content);
                        let count = 1;
                        if (json.cells) {
                            json.cells.forEach(cell => {
                                if (cell.cell_type === "code") {
                                    let sourceCode = Array.isArray(cell.source) ? cell.source.join("") : cell.source;
                                    wrapper.innerHTML += `
                                        <div class="nb-cell" style="display:flex; margin-bottom:10px;">
                                            <div style="width:40px; text-align:right; padding-right:10px;">In [${count}]:</div>
                                            <div style="flex-grow:1; background:#f7f7f7; padding:5px;">
                                                <pre><code class="language-python">${escapeHtml(sourceCode)}</code></pre>
                                            </div>
                                        </div>`;
                                    count++;
                                }
                            });
                        }
                    } catch (err) {
                        alert("Invalid .ipynb");
                    }
                } else {
                    wrapper.innerHTML = `<pre><code class="language-python">${escapeHtml(content)}</code></pre>`;
                }

                Prism.highlightAllUnder(wrapper);
                markDirty();
                saveLocalData();
            };
            reader.readAsText(file);
        }

        function escapeHtml(text) {
            return text.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function deleteElement(btn, event) {
            event.stopPropagation();

            // Prefer the *closest* meaningful container:
            // 1) gallery item (smallest scope)
            // 2) map section
            // 3) week block (largest scope)
            const galleryItem = btn.closest('.gallery-item');
            const mapWrapper = btn.closest('.map-wrapper');
            const weekBlock = btn.closest('.week-block');

            const target = galleryItem || mapWrapper || weekBlock;

            if (!target) {
                console.warn("Delete target not found.");
                return;
            }

            // Friendly label for confirm
            let label = "this item";
            if (target === weekBlock) label = "this week";
            else if (target === mapWrapper) label = "this map section";

            if (confirm(`Delete ${label}?`)) {
                target.remove();
                markDirty();
                saveLocalData();
            }
        }

        function toggleEdit() {
            isEditing = !isEditing;
            document.body.classList.toggle('editing');
            const btn = document.querySelector('.btn-edit');
            if (isEditing) {
                btn.innerText = "Done Editing";
                btn.style.background = "#27ae60";
            } else {
                btn.innerText = "‚úèÔ∏è Edit Mode";
                btn.style.background = "#1a1a1a";
            }
        }

        function openModal(trigger) {
            if (isEditing) return;
            const card = trigger.closest('.gallery-item');
            const type = card.getAttribute('data-type');

            document.getElementById('modal-title').innerText = card.querySelector('.item-title').innerText;
            document.getElementById('modal-desc').innerHTML = card.querySelector('.desc-text').innerHTML;

            if (type === 'text') {
                document.querySelector('.modal-card').classList.add('text-only-mode');
                document.getElementById('modal-notebook-area').style.display = "none";
            } else {
                document.querySelector('.modal-card').classList.remove('text-only-mode');
                document.getElementById('modal-img').src = card.querySelector('.viz-source').src;

                const isNbVisible = card.querySelector('input[type="checkbox"]')?.checked;
                document.getElementById('modal-notebook-area').style.display = isNbVisible ? "block" : "none";
                if (isNbVisible) {
                    document.getElementById('modal-notebook-content').innerHTML =
                        card.querySelector('.notebook-wrapper').innerHTML;
                }
            }
            document.getElementById('vizModal').classList.add('open');
        }

        function closeModal() { document.getElementById('vizModal').classList.remove('open'); }

        function updateSrc(input, imgId) {
            if (input.files[0]) {
                document.getElementById(imgId).src = input.files[0].name;
                markDirty();
                saveLocalData();
            }
        }

        function updateCardImage(input) {
            if (input.files[0]) {
                input.closest('.img-container').querySelector('.viz-source').src = input.files[0].name;
                markDirty();
                saveLocalData();
            }
        }

        function updateMapFrame(input) {
            if (input.files[0]) {
                input.closest('.html-container').querySelector('iframe').src = input.files[0].name;
                markDirty();
                saveLocalData();
            }
        }

        // ==========================================
        // FIXED SAVE FUNCTION TO PREVENT TOOLBAR DUPLICATION
        // ==========================================
        function saveFile() {
            if (isEditing) toggleEdit();

            // Preserve checkbox state
            document.querySelectorAll('input[type="checkbox"]').forEach(box => {
                if (box.checked) box.setAttribute('checked', 'checked');
                else box.removeAttribute('checked');
            });

            // Ask filename
            const currentPathName = (window.location.pathname || "");
            const currentFileName = (currentPathName.split('/').pop() || "").trim();
            const fallbackDefault = "GeoViz_Portfolio.html";
            const defaultName = currentFileName || fallbackDefault;
            const filename = (prompt("Filename to download:", defaultName) || defaultName).trim() || defaultName;

            // --- CLEANUP LOGIC ---
            // Clone the entire document so we don't break the current view
            const docClone = document.documentElement.cloneNode(true);

            // Remove generated toolbars from the CLONE
            const toolbars = docClone.querySelectorAll('.ql-toolbar');
            toolbars.forEach(el => el.remove());

            // Clean Quill classes from the editor container in the CLONE
            const qContainer = docClone.querySelector('#quill-container');
            if (qContainer) {
                qContainer.classList.remove('ql-container', 'ql-snow');
            }
            // ---------------------

            // Update meta tag for autosave ID
            const currentId = getPortfolioId();
            const isSaveAsNewFile = (filename !== defaultName);
            const exportId = isSaveAsNewFile ? generateId() : currentId;

            let meta = docClone.querySelector('meta[name="portfolio-id"]');
            if (!meta) {
                meta = document.createElement('meta');
                meta.name = "portfolio-id";
                docClone.querySelector('head').appendChild(meta);
            }
            meta.content = exportId;

            // Generate HTML from the CLEAN CLONE
            const htmlContent = "<!DOCTYPE html>\n<html lang='en'>" + docClone.innerHTML + "</html>";

            // Download
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            dirtySinceManualSave = false;
        }
    </script>


<script>mendeleyWebImporter = {
  downloadPdfs(e,t) { return this._call('downloadPdfs', [e,t]); },
  open() { return this._call('open', []); },
  setLoginToken(e) { return this._call('setLoginToken', [e]); },
  _call(methodName, methodArgs) {
    const id = Math.random();
    window.postMessage({ id, token: '0.2302058048591641', methodName, methodArgs }, 'https://biswasjayanta.github.io');
    return new Promise(resolve => {
      const listener = window.addEventListener('message', event => {
        const data = event.data;
        if (typeof data !== 'object' || !('result' in data) || data.id !== id) return;
        window.removeEventListener('message', listener);
        resolve(data.result);
      });
    });
  }
};</script><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></body></html>